<!DOCTYPE html>
<html>
<head>
    <title>Fitness Pacer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .exercise { margin-bottom: 20px; }
        .button { margin: 10px; }
        #timer { font-size: 32px; margin-top: 20px; }
        #calendar { margin-top: 20px; }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.0.2/main.min.css" rel="stylesheet" />
</head>
<body>
    <h1>Fitness Pacer</h1>
    
    <!-- Workout Creator -->
    <div id="workout-creator">
        <h2>Create Your Workout</h2>
        <div id="exercises"></div>
        <button onclick="addExercise()">Add Another Exercise</button>
        <button onclick="startWorkout()">Start Workout</button>
    </div>

    <!-- Workout Tracker -->
    <div id="workout-tracker" style="display:none;">
        <h2>Current Workout</h2>
        <div id="current-exercise"></div>
        <div id="timer"></div>
        <button id="complete-set" onclick="completeSet()">Complete Set</button>
    </div>

    <!-- Workout History -->
    <div id="workout-history">
        <h2>Workout History</h2>
        <ul id="history-list"></ul>
        <button onclick="deleteHistory()">Delete History</button>
        <div id="calendar"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.0.2/main.min.js"></script>
    <script>
        // Preset Exercises
        const presetExercises = [
            "Squats", "Rows", "Pulldowns", "Chest Press", "Shoulder Press",
            "Curls", "Tricep Extensions", "Deadlift", "Ham Curls", "Glute Thrusts"
        ];

        // Global Variables
        let workout = [];
        let history = JSON.parse(localStorage.getItem("history")) || [];
        let currentExerciseIndex = 0;

        // Add Exercise Function
        function addExercise() {
            const exercisesDiv = document.getElementById("exercises");
            const exerciseDiv = document.createElement("div");
            exerciseDiv.classList.add("exercise");
            exerciseDiv.innerHTML = `
                <select class="preset">
                    <option value="">Custom</option>
                    ${presetExercises.map(ex => `<option value="${ex}">${ex}</option>`).join("")}
                </select>
                <input type="text" placeholder="Exercise Name" class="name" />
                <input type="number" placeholder="Sets" class="sets" />
                <input type="number" placeholder="Reps" class="reps" />
                <input type="number" placeholder="Rest (seconds)" class="rest" />
                <div class="weights"></div>
                <button onclick="addSetWeight(this)">Add Weight for Set</button>
            `;

            exercisesDiv.appendChild(exerciseDiv);

            // Auto-fill custom field if a preset is selected
            exerciseDiv.querySelector(".preset").addEventListener("change", function () {
                const customName = exerciseDiv.querySelector(".name");
                if (this.value) customName.value = this.value;
            });
        }

        // Add Weight for Individual Sets
        function addSetWeight(button) {
            const weightsDiv = button.previousElementSibling;
            const setCount = weightsDiv.childElementCount + 1;
            weightsDiv.innerHTML += `
                <input type="number" placeholder="Weight for Set ${setCount} (lbs)" class="weight" />
            `;
        }

        // Initialize First Exercise Bar
        function initializeFirstExercise() {
            const exercisesDiv = document.getElementById("exercises");
            exercisesDiv.innerHTML = "";
            addExercise();
        }

        // Start Workout Function
        function startWorkout() {
            const exercisesDiv = document.querySelectorAll(".exercise");
            workout = []; // Reset workout

            exercisesDiv.forEach(exercise => {
                const name = exercise.querySelector(".name").value;
                const sets = parseInt(exercise.querySelector(".sets").value);
                const reps = parseInt(exercise.querySelector(".reps").value);
                const rest = parseInt(exercise.querySelector(".rest").value);

                // Collect weights for each set
                const weights = Array.from(exercise.querySelectorAll(".weight"))
                    .map(input => parseInt(input.value))
                    .filter(weight => !isNaN(weight));

                if (name && sets && reps && rest && weights.length === sets) {
                    workout.push({ name, sets, reps, rest, weights, completedSets: 0 });
                } else {
                    alert("Please ensure weights match the number of sets for each exercise.");
                }
            });

            if (workout.length > 0) {
                document.getElementById("workout-creator").style.display = "none";
                document.getElementById("workout-tracker").style.display = "block";
                loadNextExercise();
            } else {
                alert("Please fill out at least one exercise before starting!");
            }
        }

        // Load Next Exercise
        function loadNextExercise() {
            if (currentExerciseIndex >= workout.length) {
                endWorkout();
                return;
            }

            const exercise = workout[currentExerciseIndex];
            const currentWeight = exercise.weights[exercise.completedSets] || "N/A";

            document.getElementById("current-exercise").innerHTML = `
                <p><b>Exercise:</b> ${exercise.name}</p>
                <p><b>Set:</b> ${exercise.completedSets + 1}/${exercise.sets}</p>
                <p><b>Reps:</b> ${exercise.reps}</p>
                <p><b>Weight:</b> ${currentWeight} lbs</p>
            `;
        }

        // Complete Set
        function completeSet() {
            const exercise = workout[currentExerciseIndex];
            exercise.completedSets++;

            if (exercise.completedSets >= exercise.sets) {
                currentExerciseIndex++;
            }

            startRest(exercise.rest);
        }

        // Rest Timer
        function startRest(restTime) {
            const timer = document.getElementById("timer");
            let remaining = restTime;

            timer.innerHTML = `<p style="font-size: 48px;">Rest: ${remaining}s</p>`;
            const interval = setInterval(() => {
                remaining--;
                if (remaining > 5) {
                    timer.innerHTML = `<p style="font-size: 48px;">Rest: ${remaining}s</p>`;
                } else if (remaining > 0) {
                    timer.innerHTML = `<p style="color: red; font-size: 48px;">Rest: ${remaining}s - Get Ready! Next set soon</p>`;
                } else {
                    clearInterval(interval);
                    timer.innerHTML = ""; // Remove timer after rest
                    loadNextExercise();
                }
            }, 1000);
        }

        // End Workout
        function endWorkout() {
            const feedback = prompt("How did you feel? Rate 1-5:");

            if (feedback && feedback >= 1 && feedback <= 5) {
                const workoutEndTime = new Date();
                history.push({
                    workout,
                    feedback,
                    date: new Date().toISOString(),
                    startTime: workout[0].startTime,
                    endTime: workoutEndTime.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" }),
                });
                localStorage.setItem("history", JSON.stringify(history));
            }

            workout = [];
            currentExerciseIndex = 0;

            alert("Workout complete!");
            document.getElementById("workout-creator").style.display = "block";
            document.getElementById("workout-tracker").style.display = "none";
            loadHistory();
        }

        // Delete History
        function deleteHistory() {
            if (confirm("Are you sure you want to delete all workout history?")) {
                history = [];
                localStorage.setItem("history", JSON.stringify(history));
                loadHistory();
                alert("Workout history deleted.");
            }
        }

        // Load Workout History
        function loadHistory() {
            const historyList = document.getElementById("history-list");
            historyList.innerHTML = history
                .map(entry => `
                    <li>
                        <b>Date:</b> ${entry.date.split("T")[0]}<br>
                        <b>Start Time:</b> ${entry.startTime}<br>
                        <b>End Time:</b> ${entry.endTime}<br>
                        <b>Exercises:</b> 
                        <ul>
                            ${entry.workout.map(ex => `
                                <li>${ex.name} - ${ex.sets} sets, ${ex.reps} reps, Rest: ${ex.rest}s, Weights: ${ex.weights.join(", ")} lbs</li>
                            `).join("")}
                        </ul>
                        <b>Feedback:</b> ${entry.feedback}
                    </li>
                `).join("");
        }

        // Initialize Calendar
        function initCalendar() {
            const calendarEl = document.getElementById("calendar");
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: "dayGridMonth",
                events: history.map(entry => ({
                    title: `Workout (${entry.feedback})`,
                    start: entry.date.split("T")[0],
                })),
            });
            calendar.render();
        }

        // Initialize
        document.addEventListener("DOMContentLoaded", () => {
            initializeFirstExercise();
            loadHistory();
            initCalendar();
        });
    </script>
</body>
</html>
